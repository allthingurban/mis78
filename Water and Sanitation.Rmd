---
title: "Water and Sanitation"
author: "Abhinav Kumar"
date: "2023-10-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages , echo=FALSE, include=FALSE}
library(arrow)
library(tidyr)
library(dplyr)
library(pollster)
library(knitr)
library(kableExtra)
library(gt)
```

```{r data, echo=FALSE}
#Import data prepared in the data_analysis_level4.Rmd
mis78_wash=read_parquet("Water-and-Sanitation_files/mis78_wash.parquet")
```

```{r latrine_table, echo=FALSE}
#Crosstab for Type of sanitation system
rbind(mis78_wash%>%
  crosstab(y=sanitation_system,x=sector,weight = multiplier.y)%>%
  select(1,7,6,9,8,4,2,5,3),
  mis78_wash%>%
  crosstab(y=sanitation_system,x=overall,weight = multiplier.y)%>%
  rename("sector"="overall")%>%
  select(1,7,6,9,8,4,2,5,3))%>%
    kable(format = "html",
          digits = 1,
          caption = "Type of Sanitation System",
          col.names = c("","Sewer","Septic Tank","Twin Pit","Single Pit","Open Pit","Composting Pit","Others","No Latrine"),booktabs=TRUE)
```

```{r latrine_access, echo=FALSE}
#Crosstab for Type of access to latrine
rbind(mis78_wash%>%
  crosstab(y=latrine_access_recoded,x=sector,weight = multiplier.y)%>%
  select(1,2,6,5,7,4,3),
  mis78_wash%>%
  crosstab(y=latrine_access_recoded,x=overall,weight = multiplier.y)%>%
  rename("sector"="overall")%>%
  select(1,2,6,5,7,4,3))%>%
  gt()%>%
  tab_spanner(label = "Access to Latrine",
              columns = c(`Exclusive for Household`,`Shared use in Building`,`Paid PT/CT`,`Unpaid PT/CT`, Others,`No Latrine`))%>%
  fmt_number(decimals = 2,)%>%
    cols_label(
    sector = "")
```

```{r dw_source, echo=FALSE}
#Crosstab for source of drinking water
rbind(mis78_wash%>%
  crosstab(y=dw_source_recoded,x=sector,weight = multiplier.y)%>%
  select(1,3,6,4,9,10,2,7,8,5),
  mis78_wash%>%
  crosstab(y=dw_source_recoded,x=overall,weight = multiplier.y)%>%
  rename("sector"="overall")%>%
  select(1,3,6,4,9,10,2,7,8,5))%>%
  gt()%>%
  tab_spanner(label = "Source of Drinking Water",
              columns = c(`Exclusive Piped Water`,`Shared Piped Water`,Handpump,Tubewell, Well,`Bottled Water` ,`Spring/Rainwater/Surfacewater`,Tanker,Others))%>%
  fmt_number(decimals = 2)%>%
  cols_label(sector = "",
             `Spring/Rainwater/Surfacewater`="Spring/ Rainwater/ Surfacewater")%>%
  tab_style(style=cell_borders(sides = "all", color = "#000000", style = "solid", weight = 1),
            locations = list(cells_body(),cells_column_labels()))
```

```{r}
mis78_wash%>%
  crosstab(y=sanitation_system,x=sector,weight = multiplier.y)
mis78_wash%>%filter(state==21)%>%
  crosstab(y=sanitation_system,x=sector,weight = multiplier.y)
```

```{r}
#Scenario 1: Only safe containment system
mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Unsafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Unsafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")


mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Unsafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Unsafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")
```
85.7% have safe containment system. Out of this, 65% have water source within dwelling, 19.6% have water source within premises,14.9% have water source at a distance greater than a km from their dwelling. Around 55.7% of urban households in India have both, toilet connected to a safe containment system and a water source inside the dwelling. Around 16.8% of urban households have a toilet with a safe containment system and a water source inside the premises but outside the dwelling. Around 12.8% of urban households have a toilet connected to a safe containment system with a water source located a t a distance of greater than a km of the dwelling.
11.4% have unsafe containment system
2.9% have no latrine

64.9% urban households in Odisha have a toilet connected to a safe containment system. Out of this, 67% have water source within dwelling, 16.4% have water source within premises,15.8% have water source at a distance greater than a km from their dwelling. Around 44% of urban households in Odisha have both, toilet connected to a safe containment system and a water source inside the dwelling. Around 10.2% of urban households have a toilet with a safe containment system and a water source inside the premises but outside the dwelling. Around 10.6% of urban households have a toilet connected to a safe containment system with a water source located a t a distance of greater than a km of the dwelling.
16.01% have unsafe containment system
19.05% have no latrine

```{r}
#Scenario 2 : Toilet connected to any containment system and water source 
mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Safe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Safe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")


mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Safe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit")~"Safe",
                                    sanitation_system %in% c("Single Pit","Open Pit","Others")~"Safe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")
```
97.1% of urban households have access to a latrine connected to some kind of containment system. 2.9 percent of urban households do not have access to a latrine connected to a containment system.
Out of those who have a toilet,61.7 percent have a water source within  dwelling. 21.3% have water source within premises and 16.5% are dependent on a water source located at a distance greater than a km. Around 60% of urban households have access to both a toilet connected to a containment system or a sewer and a water source within dwelling. Around 20.7% of urban households in India have a toilet connected to a containment system or a sewer network and have a water source inside the premises but outside the dwelling. 16% of urban households have a toilet connected to a containment system or a sewer network and has a water source located at a distance on more than a km from the dwelling.

80.9% of urban households in Odisha have access to a latrine connected to some kind of containment system. 19.1 percent of urban households in Odisha do not have access to a latrine connected to a containment system.
Out of those who have a toilet, 60.3 percent have a water source within  dwelling. 19.3% have water source within premises and 20.4% are dependent on a water source located at a distance greater than a km. Around 48.7% of urban households have access to both a toilet connected to a containment system or a sewer and a water source within dwelling. Around 15.4% of urban households in India have a toilet connected to a containment system or a sewer network and have a water source inside the premises but outside the dwelling. 16.5% of urban households have a toilet connected to a containment system or a sewer network and has a water source located at a distance on more than a km from the dwelling.

```{r}
#Scenario 3: Only tracking containment system listed in the keyword
mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit","Single Pit")~"Safe",
                                    sanitation_system %in% c("Open Pit","Others")~"Unsafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit","Single Pit")~"Safe",
                                    sanitation_system %in% c("Open Pit","Others")~"UnSafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%filter(state==21)%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")


mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit","Single Pit")~"Safe",
                                    sanitation_system %in% c("Open Pit","Others")~"UnSafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab_3way(x=sector,y=dw_source_distance_recoded,z=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")

mis78_wash%>%
  mutate(have_containment=case_when(sanitation_system %in% c("Septic Tank","Sewer","Twin Pit","Composting/VI Pit","Single Pit")~"Safe",
                                    sanitation_system %in% c("Open Pit","Others")~"UnSafe",
                                    sanitation_system %in% c("No Latrine")~"No Latrine"))%>%
  crosstab(x=sector,y=have_containment,weight = multiplier.y)%>% filter(sector=="Urban")
```
